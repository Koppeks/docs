<header>
  <nav
    class="td-navbar navbar-dark js-navbar-scroll td-navbar-cover navbar-bg-onscroll--fade"
  >
    <div class="container-fluid flex-column flex-md-row">
      <a class="navbar-brand" href="/">
        <span class="navbar-brand__logo navbar-logo">
          {{ $svg := resources.Get "icons/logo.svg" }}
          <img class="footer-logo" src="/images/logo.svg" alt="logo" />
        </span>
        <span class="navbar-brand__name"></span
      ></a>
      <div
        class="td-navbar-nav-scroll ms-md-auto main-nav-items"
        id="main_navbar"
      >
        <ul class="navbar-nav">
          <!-- <li class="nav-item nav-external">
                        <a class="nav-link nav-link-external" href="https://playground.meshery.io" target="_blank">
                            <span>Playground</span>
                        </a>
                    </li> -->
          <li class="nav-item dropdown" data-bs-theme="dark">
            <span
            class="nav-link dropdown-toggle"
            id="productsDropdown"
            role="button"
            data-toggle="dropdown"
            aria-haspopup="true"
            aria-expanded="false"
            >
            Products
          </span>
          <div class="dropdown-menu" aria-labelledby="productsDropdown" style="margin-left:2.5rem;">
            <a
            class="dropdown-item"
            href="https://docs.meshery.io/"
            target="_blank"
            >
              <div class="logo-container">
                <img
                  src="/images/logos/meshery-light-icon.svg"
                  alt="Layer5 Meshery Logo"
                />
              </div>
              <span>Meshery</span></a
            >
              <div class="dropdown-divider"></div>
              <a
                class="dropdown-item"
                href="https://layer5.io/cloud-native-management/kanvas"
                target="_blank"
              >
                <div class="logo-container">
                  <img
                    src="/images/logos/kanvas-alt.svg"
                    alt="Layer5 Kanvas Logo"
                  />
                </div>

                <span>Kanvas</span></a
              >
              <div class="dropdown-divider"></div>
              <a
                class="dropdown-item"
                href="https://layer5.io/cloud-native-management/catalog"
                target="_blank"
              >
                <div class="logo-container">
                  <img
                    src="/images/logos/catalog.svg"
                    alt="Layer5 Catalog Logo"
                  />
                </div>

                <span>Catalog</span></a
              >
              <div class="dropdown-divider"></div>
              <a
                class="dropdown-item"
                href="https://smp-spec.io/"
                target="_blank"
              >
                <div class="logo-container">
                  <img
                    src="/images/logos/smp-light.png"
                    alt="Layer5 Cloud Native Performance Logo"
                  />
                </div>

                <span>Cloud Native Performance</span></a
              >
              <div class="dropdown-divider"></div>
              <a
                class="dropdown-item"
                href="https://getnighthawk.dev/"
                target="_blank"
              >
                <div class="logo-container">
                  <img
                    src="/images/logos/nighthawk-logo.svg"
                    alt="Layer5 Nighthawk Logo"
                  />
                </div>

                <span>Nighthawk</span></a
              >
            </div>
          </li>

          <!-- <li class="nav-item">
            <a class="nav-link" href="/cloud/tutorials/"> Tutorials</a>
          </li> -->
          <li class="nav-item">
            <a id="cloud" class="nav-link" href="/cloud/"> Cloud</a>
          </li>
          <li class="nav-item">
            <a id="kanvas" class="nav-link" href="/kanvas/"> Kanvas</a>
          </li>
          <li class="d-none d-lg-block nav-item">
            <!-- <div class="td-search">
                            <div class="td-search__icon"></div>
                            <input type="search" class="td-search__input form-control td-search-input" placeholder="Search"
                                   aria-label="Search this siteâ€¦" autocomplete="off">
                            <button id="searchKey" style="margin-left:-2rem;" class="kbc-button kbc-button-xs">/</button> 
                                </div> -->
            {{ partial "search-input-nav.html" . }}
          </li>
          <li class="nav-item dropdown" data-bs-theme="dark" id="userlist" style="display: none;">
            <div
              class="nav-link avatar-container"
              id="avatarDropdown"
              role="button"
              data-toggle="dropdown"
              aria-haspopup="true"
              aria-expanded="false"
            >
            </div>
            <div class="dropdown-menu" aria-labelledby="avatarDropdown" style="width:15rem;margin-left:-120px">
              <a
                class="dropdown-item"
                href=""
                target="_blank"
                id="cloud-link"
              >
                <div class="logo-container">
                  <img
                    src="/images/logos/5-light-no-trim.svg"
                    alt="Layer5 Meshery Logo"
                  />
                </div>
                <span>Cloud</span></a
              >
              <div class="dropdown-divider"></div>
              <a
                class="dropdown-item"
                href="https://layer5.io/cloud-native-management/kanvas"
                target="_blank"
              >
                <div class="logo-container">
                  <img
                    src="/images/logos/kanvas-alt.svg"
                    alt="Layer5 Kanvas Logo"
                  />
                </div>
                <span>Kanvas</span></a
              >
              <div class="dropdown-divider"></div>
              <div
                class="dropdown-item"
                target="_blank"
                onclick="logOut()"
              >
                <div class="logo-container">
                  <img
                    src="/images/logout.svg"
                    alt="logout logo"
                  />
                </div>
                <span>Logout</span></div
              >
              <div class="dropdown-divider"></div>
            </div>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <script>
  function setupDropdown(dropdownId) {
    const dropdown = document.querySelector(`#${dropdownId}`);
    const dropdownMenu = dropdown.nextElementSibling;

    
    dropdown.addEventListener("click", function (event) {
    event.stopPropagation();

    closeOtherDropdowns(dropdownId);
    dropdown.classList.toggle("current");
    dropdownMenu.classList.toggle("show");
  });

    document.body.addEventListener('click', function() {
      if (dropdown.classList.contains("current")) {
        dropdown.classList.remove("current");
        dropdownMenu.classList.remove("show");
    }
  });
}
function closeOtherDropdowns(currentDropdownId) {
  const allDropdowns = document.querySelectorAll(".nav-item.dropdown");

  // close all dropdowns except current one
  allDropdowns.forEach(function (dropdown) {
    if (dropdown.querySelector(`#${currentDropdownId}`) === null) {
      dropdown.classList.remove("current");
      const dropdownMenu = dropdown.querySelector(".dropdown-menu");
      if (dropdownMenu) {
        dropdownMenu.classList.remove("show");
      }
    }
  });
}

  setupDropdown("productsDropdown");
  setupDropdown("avatarDropdown");
    // console.log(window.location.pathname == "/cloud/");
    // check if the current page ic cloud
    let cur;
    if (window.location.pathname.includes("/cloud/"))
      cur = document.querySelector("#cloud");
    else if (window.location.pathname.includes("/kanvas/"))
      cur = document.querySelector("#kanvas");
    if (cur) {
      cur.classList.add("current");
      cur.href = "javascript: void(0)";
    }

  function removeCookie(cookieName) {
    document.cookie = cookieName + "=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
  }

  function getCookieValue(cookieName) {
    const cookies = document.cookie.split(";");
    for (let i = 0; i < cookies.length; i++) {
      let cookie = cookies[i].trim();
      if (cookie.indexOf(cookieName + "=") === 0) {
        return cookie.substring(cookieName.length + 1);
      }
    }
    const tto = "eyJhY2Nlc3NfdG9rZW4iOiJleUpoYkdjaU9pSlNVekkxTmlJc0ltdHBaQ0k2SW5CMVlteHBZenBsT0dWbU5ERmpNeTFpWldWbUxUUmlZakV0T0dVNE1DMHpOakExTVRZeU4yTTJNakVpTENKMGVYQWlPaUpLVjFRaWZRLmV5SmhkV1FpT2x0ZExDSmpiR2xsYm5SZmFXUWlPaUp0WlhOb1pYSjVMV05zYjNWa0lpd2laWGh3SWpveE56STNOemc1TXpNM0xDSmxlSFFpT250OUxDSnBZWFFpT2pFM01qYzNNREk1TXpZc0ltbHpjeUk2SW1oMGRIQnpPaTh2YldWemFHVnllUzVzWVhsbGNqVXVhVzh2YUhsa2NtRXZJaXdpYW5ScElqb2lZelE1TlRRell6Y3ROemMxTnkwMFpEQXpMV0ppTmpVdFpHWTBNalUwWmpsa1kySTBJaXdpYm1KbUlqb3hOekkzTnpBeU9UTTJMQ0p6WTNBaU9sc2liM0JsYm1sa0lpd2liMlptYkdsdVpTSXNJbTltWm14cGJtVmZZV05qWlhOeklsMHNJbk4xWWlJNkltUnRiSHBoUjBaelpHMXNNbHBYY3pCUFJHaEJXakl4YUdGWGQzVlpNamwwT21KWFZucGhSMVo1WlZNeGFtSkhPVEZhUVQwOUluMC5ldzVLeWZyQ2NYZjRVVGtpRmxhVmNSWmZmNWhoc1I5YjV4YmpNTlFRVlhWd2hLTUlZbEp4LTdoaDRjY1hmbE01WTFvMHJfNzJycTdKbndkejhBaXlpVTFoc0hnRWlEN3FGLTd6aXNlaThVNHBjcWJxSldUeXo0Rm5wX0cwR3ZuaVBzT05uOVA0NzdQY0xWVm1iMmRWR0V2TGxrS1VNSFc5NWxWdDJGLWJvRHpLeVoyUzk0dkRGaE1aQTUxdE5ES1dRdmFtT1dKLWh2dUdsTXRwN3dWMUdmR2txVnlVT3VxNFhNdFlfRUxJc2lBWElvVVdKeGE3RFdlb21HaHVyNExTSVhHa1FOS1hBU1pTckdsVkhpSjB0ZmZSX0JJNW1lV2E2QmNoeWJaMmpFM0NuakpaN2VmQngtbnVMNmtveWZ3dUFkcm1Lb1FLYTlsbDdTcmNUSjZkMy13TWhmY2dNRlZBX2NXb3B2MEFSc0pOeW5XYkpfOXlGQWZxdV9IQ2YxN1JwODRQeUdwSVE3ZVJWZnZreDNOUXBMQkhLRnBtbS1EV0lnRzROMnYwdko4MXl0dlpESTFGa0ZYSlUzRGpkT2pKMHBQU25xenpTenR5ZHZnRnh2OTY0YlAxemI0ZDV0MlJPMVlxdEF2eFFpOEk4c29CcWZiMGxaWUlzX09SLWxmTHM1OGh1VTZRQXkxRHZxMjdhRnJ3NjRCR1VRLVJ5V3pxNVdYa0ZFcTBDUHhaVGNKMWVqM25wVjZ4NlRaLVdnWHBHUmctaWtkX2hlYzZFSDdNbmFXVjRmc2hyZ0Q5X015V0Y3NFEtQjkzXzdkMmd5ZFhfUEdMa2tsZm9GV1RIR2gwMlVRSHh4R212cGFNOGdwSG5uaV9oZ01xV21TeTJuT2p1cDJRMkZuZDVrRSIsInRva2VuX3R5cGUiOiJiZWFyZXIiLCJyZWZyZXNoX3Rva2VuIjoiYTJvc0d1X1dTWjloZUVCWGY3ZW0zbzJyNGdUTUhHMFZ5ZXdROExPcFNEOC5MVU1ZWjhLc2hYd1JJaXBtNFNYZW5wNmNDNHRsU0JkaU9TNldtX1o0WGJvIiwiZXhwaXJ5IjoiMjAyNC0xMC0wMVQxMzoyODo1Ni4xMDk0ODgzMTNaIn0"
    return tto;
  }
  function logOut() {
    removeCookie("provider_token");
    document.getElementById("userlist").style.display = "none"; 
    // Open logout API link in a new tab
    window.open("https://meshery.layer5.io/logout", "_blank");
    // Refresh the current page
    window.location.reload();
  }
  const checkUserAuth = async () => {
    const CLOUD_USER_API = "https://meshery.layer5.io/api/identity/users/profile";
    try {
      const token = getCookieValue("provider_token");
      if (!token) {
      throw new Error("authentication failed");
    }
      const re = await fetch(CLOUD_USER_API, {
        method: 'GET',
        headers: {
          'Authorization': `Bearer ${token}`,
        },
      });

      if (re.status !== 200) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }

      const response = await re.json();
      updateUI(response);

  } catch (error) {
    console.error("could not set user details.", error);
  }
};
function updateUI(response) {
document.getElementById("userlist").style.display = "block";
const avatarUrl = response.avatar_url;
const avatarContainer = document.querySelector('.avatar-container');
avatarContainer.style.backgroundImage = `url("${avatarUrl}")`;
avatarContainer.style.backgroundSize = 'cover';

const userId = response.id;
const cloudLink = document.getElementById('cloud-link');
cloudLink.href = `https://meshery.layer5.io/user/${userId}`;
}

checkUserAuth();
  </script>
</header>
